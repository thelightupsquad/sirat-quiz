<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>সীরাতুন নবী ﷺ প্রতিযোগিতা</title>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #0f766e;
            background: -webkit-linear-gradient(135deg, #0f766e 0%, #065f46 50%, #064e3b 100%);
            background: linear-gradient(135deg, #0f766e 0%, #065f46 50%, #064e3b 100%);
            min-height: 100vh;
            padding: 8px;
            position: relative;
            overflow-x: hidden;
            transition: background 0.5s ease;
        }
        
        body.warning-time {
            background: #dc2626;
            background: -webkit-linear-gradient(135deg, #fca5a5 0%, #f87171 50%, #ef4444 100%);
            background: linear-gradient(135deg, #fca5a5 0%, #f87171 50%, #ef4444 100%);
            -webkit-animation: backgroundPulse 1s infinite;
            animation: backgroundPulse 1s infinite;
        }
        
        @-webkit-keyframes backgroundPulse {
            0%, 100% { 
                background: -webkit-linear-gradient(135deg, #fca5a5 0%, #f87171 50%, #ef4444 100%);
            }
            50% { 
                background: -webkit-linear-gradient(135deg, #fecaca 0%, #fca5a5 50%, #f87171 100%);
            }
        }
        
        @keyframes backgroundPulse {
            0%, 100% { 
                background: linear-gradient(135deg, #fca5a5 0%, #f87171 50%, #ef4444 100%);
            }
            50% { 
                background: linear-gradient(135deg, #fecaca 0%, #fca5a5 50%, #f87171 100%);
            }
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            padding-bottom: 15px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            padding: 20px;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #10b981;
        }
        
        h1 {
            color: #065f46;
            font-size: 2em;
            text-align: center;
            margin-bottom: 8px;
            font-weight: 800;
            line-height: 1.2;
        }
        
        .subtitle {
            color: #6b7280;
            text-align: center;
            margin-bottom: 16px;
            font-size: 15px;
            font-weight: 500;
        }
        
        .info-box {
            background: #d1fae5;
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 16px;
            border: 2px solid rgba(16, 185, 129, 0.2);
        }
        
        .info-box h3 {
            color: #065f46;
            margin-bottom: 10px;
            font-size: 17px;
            font-weight: 700;
        }
        
        .info-box ul {
            list-style: none;
            padding: 0;
        }
        
        .info-box li {
            color: #374151;
            margin: 6px 0;
            padding-left: 22px;
            position: relative;
            font-size: 14px;
            line-height: 1.4;
        }

        .info-box li::before {
            content: '\2713';
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
            font-size: 15px;
        }

        .warning-box {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 14px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .warning-box p {
            color: #78350f;
            font-weight: 600;
            margin: 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .form-group {
            margin-bottom: 14px;
        }
        
		.time-banner {
    position: fixed;
    top: 20px;
    left: 5%;
    right: 5%;
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    color: #78350f;
    padding: 15px 20px;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(251, 191, 36, 0.5);
    z-index: 9999;
    font-weight: 700;
    font-size: 15px;
    text-align: center;
    animation: slideDown 0.5s ease, fadeOut 0.5s ease 4.5s;
    line-height: 1.4;
}

.time-banner.warning {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    animation: slideDown 0.5s ease, pulse 1s infinite, fadeOut 0.5s ease 4.5s;
}

@keyframes slideDown {
    from {
        top: -100px;
        opacity: 0;
    }
    to {
        top: 20px;
        opacity: 1;
    }
}

@keyframes fadeOut {
    to {
        opacity: 0;
        top: -100px;
    }
}
		
        label {
            display: block;
            color: #1f2937;
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 14px;
        }
        
        input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            background: white;
        }
        
        input:focus {
            outline: none;
            border-color: #10b981;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            font-size: 15px;
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            text-align: center;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #10b981;
            color: white;
        }
        
        .btn-primary:active {
            background: #059669;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
            padding: 12px 14px;
            width: auto;
            font-size: 16px;
            display: inline-block;
            font-weight: 700;
        }
        
        .btn-secondary:active {
            background: #d1d5db;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #78350f;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
            font-size: 16px;
            font-weight: 800;
        }

        .btn-danger:active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
        }
        
       .timer-box {
    background: rgba(255, 255, 255, 0.99);
    border-radius: 12px;
    padding: 12px 16px;
    border: 2px solid rgba(186, 230, 253, 0.3);
    position: fixed; /*sticky;relative; fixed থেকে relative */
    top: 8px;
    left: 8px;
    right: 8px;
	margin-top: 20px;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    max-width: 884px;
    margin-left: auto;
    margin-right: auto;
}

      .quiz-content-wrapper {
    padding-top: 0px;  /* Timer box এর জন্য space */
}
		
        .timer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0px;
			gap: 10px;
        }
        
        .timer-info {
            color: #065f46;
            font-weight: 700;
            font-size: 20px;
        }
        
        .timer {
            color: #ef4444;
            font-size: 22px;
            font-weight: 900 !important;
            font-family: 'Courier New', monospace;
        }
        
        .timer.warning {
            -webkit-animation: pulse 1s infinite;
            animation: pulse 1s infinite;
        }
        
        @-webkit-keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .question-card {
            background: white;
            border-radius: 12px;
            padding: 18px;
			margin-top: 0px;
            margin-bottom: 12px;       
            border: 2px solid #f3f4f6;
            text-align: center;
        }
        
        .question-badge {
            display: inline-block;
            background: #d1fae5;
            color: #065f46;
            padding: 4px 10px;
            border-radius: 14px;
            font-size: 10px;
            font-weight: 700;
            margin-bottom: 8px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .question-text {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 14px;
            line-height: 1.3;
        }
        
        .option {
            width: 100%;
            padding: 11px 14px;
            margin: 5px 0;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            text-align: left;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            display: block;
        }
        
        .option:active {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .option.selected {
            border-color: #10b981;
            background: #d1fae5;
        }
		
        .short-answer-input {
            width: 100%;
            padding: 12px 14px;
            margin: 10px 0;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            background: white;
            text-align: center;
            font-weight: 600;
        }

        .short-answer-input:focus {
            outline: none;
            border-color: #10b981;
            background: #f0fdf4;
        }

        .short-answer-input.filled {
            border-color: #10b981;
            background: #d1fae5;
        }
		
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            gap: 10px;
        }

        .nav-buttons .btn-secondary {
            margin: 0;
            flex: 0 0 auto;  
            min-width: 80px;  
        }

        .nav-buttons .btn-danger {
            margin: 0;
            flex: 1;
        }
        
        .success-icon {
            text-align: center;
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .success-message {
            text-align: center;
        }
        
        .success-message h2 {
            color: #065f46;
            font-size: 28px;
            margin-bottom: 16px;
            font-weight: 800;
        }
        
        .success-message p {
            color: #6b7280;
            font-size: 16px;
            margin: 12px 0;
            line-height: 1.5;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #10b981;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin: 20px auto;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 10000;
            padding: 20px;
            display: table;
            width: 100%;
            height: 100%;
        }
        
        .modal-inner {
            display: table-cell;
            vertical-align: middle;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            max-width: 420px;
            margin: 0 auto;
        }

       @media (max-width: 480px) {
		   
            body {
                padding: 6px;
            }
            
            h1 {
                font-size: 1.4em;
            }
            
            .card {
                padding: 16px;
            }

		   .quiz-content-wrapper {
        padding-top: 75px;  /* Mobile এ কম space */
    }    
            .timer-box {
        padding: 8px 12px;
        top: 6px;
        left: 6px;
        right: 6px;
    }
    
    .timer-header {
        margin-bottom: 0;
    }
    
    .timer-info {
        font-size: 16px;
        line-height: 1.2;
    }
    
    .timer {
        font-size: 18px;
        line-height: 1.2;
    }
    
    .question-card {
        padding: 18px;
        margin-bottom: 12px;    
    }
            
            .question-text {
                font-size: 18px;
            }
            
            .option {
                font-size: 16px;
                padding: 18px 14px;
            }

            .modal-content {
                padding: 25px 20px;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
	
	function toBengaliNumber(num) {
    var bengali = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
    return num.toString().split('').map(function(d) { return bengali[d]; }).join('');
}

function getBengaliOption(index) {
    var options = ['ক', 'খ', 'গ', 'ঘ'];
    return options[index];
}
	
        var GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzwJhsTHPfQZEQOE4BQNnPv_SqF4NLHZ0pANIgFixMMkbJQF4APDHBYZf0K7-VrRcKf/exec';
                                 
        var QUESTIONS = [
    // MCQ Questions (50)
    {
        id: 1,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কোন সালে জন্মগ্রহণ করেন?',
        options: ['৫৭০ খ্রিস্টাব্দ', '৫৬০ খ্রিস্টাব্দ', '৫৮০ খ্রিস্টাব্দ', '৫৯০ খ্রিস্টাব্দ']
    },
    {
        id: 2,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর পিতার নাম কী? রাসূলুল্লাহ ﷺ এর পিতার নাম কী? রাসূলুল্লাহ ﷺ এর পিতার নাম কী? রাসূলুল্লাহ ﷺ এর পিতার নাম কী? রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?রাসূলুল্লাহ ﷺ এর পিতার নাম কী?',
        options: ['আবু তালিব', 'আবদুল্লাহ', 'আবদুল মুত্তালিব', 'আবু বকর']
    },
    {
        id: 3,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর দুধ মাতার নাম কী?',
        options: ['আমিনা', 'হালিমা', 'খাদিজা', 'আয়িশা']
    },
    {
        id: 4,
        type: 'mcq',
        question: 'প্রথম কোন মহিলা ইসলাম গ্রহণ করেন?',
        options: ['আয়িশা রা.', 'ফাতিমা রা.', 'খাদিজা রা.', 'হাফসা রা.']
    },
    {
        id: 5,
        type: 'mcq',
        question: 'হিজরতের সময় রাসূলুল্লাহ ﷺ এর সাথী কে ছিলেন?',
        options: ['উমর রা.', 'আবু বকর রা.', 'উসমান রা.', 'আলী রা.']
    },
    {
        id: 6,
        type: 'mcq',
        question: 'বদর যুদ্ধ কোন সালে সংঘটিত হয়?',
        options: ['২ হিজরী', '৩ হিজরী', '৪ হিজরী', '৫ হিজরী']
    },
    {
        id: 7,
        type: 'mcq',
        question: 'উহুদ যুদ্ধে রাসূলুল্লাহ ﷺ এর কয়টি দাঁত শহীদ হয়?',
        options: ['১টি', '২টি', '৩টি', '৪টি']
    },
    {
        id: 8,
        type: 'mcq',
        question: 'মক্কা বিজয় কোন সালে হয়?',
        options: ['৬ হিজরী', '৭ হিজরী', '৮ হিজরী', '৯ হিজরী']
    },
    {
        id: 9,
        type: 'mcq',
        question: 'পিতার দিক থেকে নবিজির বংশধারায় "মুদরিকা" -এর পুত্র কে?',
        options: ['মুদর', 'রূহ', 'খুযাইমাহ', 'মালিক']
    },
    {
        id: 10,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কোন গোত্রে জন্মগ্রহণ করেন?',
        options: ['কুরাইশ', 'খাযরাজ', 'আউস', 'তামিম']
    },
    {
        id: 11,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কত বছর বয়সে ইয়াতিম হন?',
        options: ['৬ বছর', '৪ বছর', '৮ বছর', '১০ বছর']
    },
    {
        id: 12,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর দাদার নাম কী?',
        options: ['আবদুল মুত্তালিব', 'আবু তালিব', 'হাশিম', 'আব্বাস']
    },
    {
        id: 13,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কোন পাহাড়ের গুহায় ধ্যান করতেন?',
        options: ['হেরা', 'সাওর', 'আরাফাত', 'উহুদ']
    },
    {
        id: 14,
        type: 'mcq',
        question: 'প্রথম ওহী নাযিলের সময় রাসূলুল্লাহ ﷺ এর বয়স কত ছিল?',
        options: ['৪০ বছর', '৩৫ বছর', '৪৫ বছর', '৩০ বছর']
    },
    {
        id: 15,
        type: 'mcq',
        question: 'প্রথম কোন পুরুষ ইসলাম গ্রহণ করেন?',
        options: ['আবু বকর রা.', 'উমর রা.', 'আলী রা.', 'উসমান রা.']
    },
    {
        id: 16,
        type: 'mcq',
        question: 'খাদিজা রা. রাসূলুল্লাহ ﷺ কে বিয়ে করার সময় তাঁর বয়স কত ছিল?',
        options: ['৪০ বছর', '৩৫ বছর', '৩০ বছর', '৪৫ বছর']
    },
    {
        id: 17,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর কয়জন পুত্র ছিল?',
        options: ['৩ জন', '২ জন', '৪ জন', '৫ জন']
    },
    {
        id: 18,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর কয়জন কন্যা ছিল?',
        options: ['৪ জন', '৩ জন', '২ জন', '৫ জন']
    },
    {
        id: 19,
        type: 'mcq',
        question: 'হাবশায় প্রথম হিজরত কোন সালে হয়?',
        options: ['৫ নবুবী', '৩ নবুবী', '৭ নবুবী', '৪ নবুবী']
    },
    {
        id: 20,
        type: 'mcq',
        question: 'মক্কা থেকে মদীনায় হিজরতের সময় রাসূলুল্লাহ ﷺ কোন গুহায় আশ্রয় নেন?',
        options: ['সাওর', 'হেরা', 'হিরা', 'আরাফাত']
    },
    {
        id: 21,
        type: 'mcq',
        question: 'মদীনায় সর্বপ্রথম কোন মসজিদ নির্মিত হয়?',
        options: ['মসজিদে কুবা', 'মসজিদে নববী', 'মসজিদে আকসা', 'মসজিদুল হারাম']
    },
    {
        id: 22,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ মদীনায় কার বাড়িতে প্রথম অবস্থান করেন?',
        options: ['আবু আইয়ুব আনসারী রা.', 'আনাস রা.', 'সা\'দ রা.', 'উসাইদ রা.']
    },
    {
        id: 23,
        type: 'mcq',
        question: 'বদর যুদ্ধে মুসলমানদের সংখ্যা কত ছিল?',
        options: ['৩১৩ জন', '৩০০ জন', '৪০০ জন', '৫০০ জন']
    },
    {
        id: 24,
        type: 'mcq',
        question: 'বদর যুদ্ধে কাফিরদের সংখ্যা কত ছিল?',
        options: ['১০০০ জন', '৮০০ জন', '১২০০ জন', '৯০০ জন']
    },
    {
        id: 25,
        type: 'mcq',
        question: 'উহুদ যুদ্ধ কোন সালে সংঘটিত হয়?',
        options: ['৩ হিজরী', '২ হিজরী', '৪ হিজরী', '৫ হিজরী']
    },
    {
        id: 26,
        type: 'mcq',
        question: 'খন্দক যুদ্ধ কোন সালে সংঘটিত হয়?',
        options: ['৫ হিজরী', '৪ হিজরী', '৬ হিজরী', '৭ হিজরী']
    },
    {
        id: 27,
        type: 'mcq',
        question: 'হুদাইবিয়ার সন্ধি কোন সালে সংঘটিত হয়?',
        options: ['৬ হিজরী', '৫ হিজরী', '৭ হিজরী', '৮ হিজরী']
    },
    {
        id: 28,
        type: 'mcq',
        question: 'খাইবার বিজয় কোন সালে সংঘটিত হয়?',
        options: ['৭ হিজরী', '৬ হিজরী', '৮ হিজরী', '৯ হিজরী']
    },
    {
        id: 29,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কোন সালে ইন্তেকাল করেন?',
        options: ['১১ হিজরী', '১০ হিজরী', '১২ হিজরী', '৯ হিজরী']
    },
    {
        id: 30,
        type: 'mcq',
        question: 'বিদায় হজ্জ কোন সালে সংঘটিত হয়?',
        options: ['১০ হিজরী', '৯ হিজরী', '১১ হিজরী', '৮ হিজরী']
    },
    {
        id: 31,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর চাচা হামজা রা. কোন যুদ্ধে শহীদ হন?',
        options: ['উহুদ', 'বদর', 'খন্দক', 'খাইবার']
    },
    {
        id: 32,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর স্ত্রী আয়িশা রা. এর পিতা কে ছিলেন?',
        options: ['আবু বকর রা.', 'উমর রা.', 'উসমান রা.', 'আলী রা.']
    },
    {
        id: 33,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর কন্যা ফাতিমা রা. এর স্বামী কে ছিলেন?',
        options: ['আলী রা.', 'উসমান রা.', 'আবু বকর রা.', 'উমর রা.']
    },
    {
        id: 34,
        type: 'mcq',
        question: 'মুয়াজ্জিনে রাসূল কে ছিলেন?',
        options: ['বিলাল রা.', 'আবু বকর রা.', 'উমর রা.', 'আলী রা.']
    },
    {
        id: 35,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর প্রিয় ঘোড়ার নাম কী ছিল?',
        options: ['সাকব', 'লিজাম', 'জুহাফা', 'বালখা']
    },
    {
        id: 36,
        type: 'mcq',
        question: 'ইসলামের প্রথম শহীদ কে?',
        options: ['সুমাইয়া রা.', 'ইয়াসির রা.', 'হামজা রা.', 'মুসআব রা.']
    },
    {
        id: 37,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কোন দিন ইন্তেকাল করেন?',
        options: ['সোমবার', 'শুক্রবার', 'বৃহস্পতিবার', 'শনিবার']
    },
    {
        id: 38,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কোথায় সমাহিত আছেন?',
        options: ['মদীনা', 'মক্কা', 'জেরুজালেম', 'তায়েফ']
    },
    {
        id: 39,
        type: 'mcq',
        question: 'মিরাজের রাতে রাসূলুল্লাহ ﷺ কত ওয়াক্ত নামাজ উপহার পান?',
        options: ['৫ ওয়াক্ত', '৩ ওয়াক্ত', '৭ ওয়াক্ত', '৯ ওয়াক্ত']
    },
    {
        id: 40,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কোন মাসে জন্মগ্রহণ করেন?',
        options: ['রবিউল আউয়াল', 'রমজান', 'মুহররম', 'শাওয়াল']
    },
    {
        id: 41,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ এর দুধ ভাই কে ছিলেন?',
        options: ['আবদুল্লাহ ইবনে হারেস', 'আবদুল্লাহ ইবনে আব্বাস', 'আবদুল্লাহ ইবনে উমর', 'আবদুল্লাহ ইবনে মাসউদ']
    },
    {
        id: 42,
        type: 'mcq',
        question: 'আবু লাহাব কে ছিলেন?',
        options: ['রাসূলের চাচা', 'রাসূলের ভাই', 'রাসূলের পিতা', 'রাসূলের দাদা']
    },
    {
        id: 43,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ ছোটবেলায় কোন কাজ করতেন?',
        options: ['মেষ চরানো', 'ব্যবসা', 'কৃষিকাজ', 'শিক্ষকতা']
    },
    {
        id: 44,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কত বছর বয়সে প্রথম ব্যবসায়িক সফরে যান?',
        options: ['১২ বছর', '১০ বছর', '১৫ বছর', '২০ বছর']
    },
    {
        id: 45,
        type: 'mcq',
        question: 'তাবুক যুদ্ধ কোন সালে সংঘটিত হয়?',
        options: ['৯ হিজরী', '৮ হিজরী', '১০ হিজরী', '৭ হিজরী']
    },
    {
        id: 46,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ মক্কা থেকে কোথায় হিজরত করেন?',
        options: ['মদীনা', 'তায়েফ', 'হাবশা', 'সিরিয়া']
    },
    {
        id: 47,
        type: 'mcq',
        question: 'আনসার কারা?',
        options: ['মদীনার মুসলমান', 'মক্কার মুসলমান', 'হাবশার মুসলমান', 'সিরিয়ার মুসলমান']
    },
    {
        id: 48,
        type: 'mcq',
        question: 'মুহাজির কারা?',
        options: ['মক্কা থেকে হিজরতকারী', 'মদীনার অধিবাসী', 'হাবশার অধিবাসী', 'বেদুইন']
    },
    {
        id: 49,
        type: 'mcq',
        question: 'কুরআনের প্রথম সূরা কোনটি নাযিল হয়?',
        options: ['সূরা আলাক', 'সূরা ফাতিহা', 'সূরা বাকারা', 'সূরা ইখলাস']
    },
    {
        id: 50,
        type: 'mcq',
        question: 'রাসূলুল্লাহ ﷺ কত বছর বয়সে ওফাত পান?',
        options: ['৬৩ বছর', '৬০ বছর', '৬৫ বছর', '৭০ বছর']
    },
    
    // Short Answer Questions (25)
    {
        id: 51,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর মাতার নাম কী?'
    },
    {
        id: 52,
        type: 'short',
        question: 'প্রথম ওহী কোন সূরার আয়াত ছিল?'
    },
    {
        id: 53,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ কত বছর বয়সে নবুওয়াত লাভ করেন? (শুধু সংখ্যা)'
    },
    {
        id: 54,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর জন্মস্থান কোথায়?'
    },
    {
        id: 55,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর কনিষ্ঠ কন্যার নাম কী?'
    },
    {
        id: 56,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর প্রিয় স্ত্রীর নাম কী?'
    },
    {
        id: 57,
        type: 'short',
        question: 'হিজরী সন কোন বছর থেকে শুরু হয়? (সংখ্যা)'
    },
    {
        id: 58,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর আমল নামা লেখক কে ছিলেন?'
    },
    {
        id: 59,
        type: 'short',
        question: 'মক্কা বিজয়ের বছরকে কী বলা হয়?'
    },
    {
        id: 60,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর প্রথম পুত্রের নাম কী?'
    },
    {
        id: 61,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর সবচেয়ে কাছের সাহাবী কে ছিলেন?'
    },
    {
        id: 62,
        type: 'short',
        question: 'মিরাজের রাতে কোন বাহনে আরোহণ করেন?'
    },
    {
        id: 63,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ কত বছর বয়সে বিবাহ করেন? (শুধু সংখ্যা)'
    },
    {
        id: 64,
        type: 'short',
        question: 'খন্দক যুদ্ধে কার পরামর্শে পরিখা খনন করা হয়?'
    },
    {
        id: 65,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর প্রিয় খাবার কী ছিল?'
    },
    {
        id: 66,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ কোন দিন জন্মগ্রহণ করেন?'
    },
    {
        id: 67,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর উপাধি কী ছিল?'
    },
    {
        id: 68,
        type: 'short',
        question: 'মদীনার পূর্ব নাম কী ছিল?'
    },
    {
        id: 69,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ কত বছর মক্কায় ছিলেন? (শুধু সংখ্যা)'
    },
    {
        id: 70,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ কত বছর মদীনায় ছিলেন? (শুধু সংখ্যা)'
    },
    {
        id: 71,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর দাদা কত বছর বয়সে ইন্তেকাল করেন? (শুধু সংখ্যা)'
    },
    {
        id: 72,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর ধাত্রী মা কোন গোত্রের ছিলেন?'
    },
    {
        id: 73,
        type: 'short',
        question: 'কাবা ঘর পুনর্নির্মাণের সময় রাসূলুল্লাহ ﷺ এর বয়স কত ছিল? (শুধু সংখ্যা)'
    },
    {
        id: 74,
        type: 'short',
        question: 'রাসূলুল্লাহ ﷺ এর সচিব কে ছিলেন?'
    },
    {
        id: 75,
        type: 'short',
        question: 'ওয়াহী লেখক সাহাবীদের মধ্যে সবচেয়ে প্রসিদ্ধ কে?'
    }
];
	var TotalTime = 3 * 60; // Total quiz time in seconds
	
        var state = {
            view: 'start',
            participant: { name: '', phone: '' },
            answers: {},
            currentQuestion: 0,
            timeLeft: TotalTime,
            startTime: null,
            timerInterval: null,
            loading: false,
            lastSubmission: null,
            submittedPhones: {},
            exitCount: 0,
            sessionId: null,
            warningPlayed: false,
			halfTimeShown: false,      // Add this
            fifteenMinShown: false     // Add this
        };

        var audioContext = null;
        var hasPlayedWarning = false;
        
        function initAudio() {
            try {
                var AudioContext = window.AudioContext || window.webkitAudioContext;
                if (AudioContext) {
                    audioContext = new AudioContext();
                }
            } catch (e) {
                console.log('Audio not supported');
            }
        }
        
        function playWarningBeep() {
            if (!audioContext || hasPlayedWarning) return;
            
            try {
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200, 100, 200, 100, 200, 100, 200, 100, 200, 100, 200, 100, 200, 100, 200, 100, 200]);
                }
                
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                var startTime = audioContext.currentTime;
                var beepInterval = 0.7;
                var totalDuration = 5;
                var beepCount = Math.floor(totalDuration / beepInterval);
                
                for (var i = 0; i < beepCount; i++) {
                    (function(index) {
                        var oscillator = audioContext.createOscillator();
                        var gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(800, startTime + (index * beepInterval));
                        
                        gainNode.gain.setValueAtTime(0, startTime + (index * beepInterval));
                        gainNode.gain.linearRampToValueAtTime(0.3, startTime + (index * beepInterval) + 0.05);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + (index * beepInterval) + 0.4);
                        
                        oscillator.start(startTime + (index * beepInterval));
                        oscillator.stop(startTime + (index * beepInterval) + 0.4);
                    })(i);
                }
                
                hasPlayedWarning = true;
            } catch (e) {
                console.log('Warning error:', e);
            }
        }
		
		function showTimeBanner(message, isWarning) {
    // Remove existing banner if any
    var existing = document.getElementById('timeBanner');
    if (existing) {
        existing.parentNode.removeChild(existing);
    }
    
    var banner = document.createElement('div');
    banner.id = 'timeBanner';
    banner.className = 'time-banner' + (isWarning ? ' warning' : '');
    banner.innerHTML = message;
    document.body.appendChild(banner);
    
    // Auto remove after 5 seconds
    setTimeout(function() {
        if (banner.parentNode) {
            banner.parentNode.removeChild(banner);
        }
    }, 5000);
}

        function generateSessionId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

		function formatTime(sec) {
    var m = Math.floor(sec / 60);
    var s = sec % 60;
    var sStr = s < 10 ? '০' + toBengaliNumber(s) : toBengaliNumber(s);
    return toBengaliNumber(m) + ':' + sStr;
}

        function startQuiz() {
            var nameInput = document.getElementById('name');
            var phoneInput = document.getElementById('phone');
            
            if (!nameInput || !phoneInput) return;
            
            var name = nameInput.value.replace(/^\s+|\s+$/g, '');
            var phone = phoneInput.value.replace(/^\s+|\s+$/g, '');
            
            if (!name || !phone) {
                alert('নাম ও মোবাইল নম্বর দিন');
                return;
            }
	
            if (!/^01\d{9}$/.test(phone)) {
                alert('সঠিক মোবাইল নম্বর দিন');
                return;
            }

            if (state.submittedPhones[phone]) {
                alert('এই নম্বর দিয়ে ইতিমধ্যে দেওয়া হয়েছে!');
                return;
            }

            state.participant = { name: name, phone: phone };
            state.startTime = Date.now();
            state.sessionId = generateSessionId();
            state.view = 'quiz';
            state.exitCount = 0;

			// First render, then request fullscreen
    render();
    
    // Fullscreen request - এখন এটা শেষে
    setTimeout(function() {
        try {
            var elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(function(err) {
                    console.log('Fullscreen error:', err);
                });
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        } catch (e) {
            console.log('Fullscreen not supported');
        }
    }, 100);
    
    startTimer();
}

        function startTimer() {
            if (state.timerInterval) clearInterval(state.timerInterval);
            
            if (!audioContext) {
                initAudio();
            }
            
            state.timerInterval = setInterval(function() {
                state.timeLeft--;
                if (state.timeLeft <= 0) submitQuiz();
                updateTimer();
            }, 1000);
        }

        function updateTimer() {
    var el = document.getElementById('timer');
    if (el) {
        el.textContent = formatTime(state.timeLeft);
        el.className = state.timeLeft <= 30 ? 'timer warning' : 'timer';
    }
    
    // Half time warning (50% of total time)
var halfTime = Math.floor(TotalTime / 2);
if (state.timeLeft === halfTime && !state.halfTimeShown) {
    state.halfTimeShown = true;
    var remainingMinutes = Math.floor(state.timeLeft / 60); // Convert seconds to minutes
    showTimeBanner('⏰ অর্ধেক সময় শেষ! আরও ' + toBengaliNumber(remainingMinutes) + ' মিনিট বাকি।', false);
}
    
	
    // 75% time warning (25% time left)
    var quarterTime = Math.floor(TotalTime / 4);
    if (state.timeLeft === quarterTime && !state.quarterTimeShown) {
        state.quarterTimeShown = true;
        var remainingMinutes = Math.floor(state.timeLeft / 60);
        showTimeBanner('⚠️ সতর্কতা! আর মাত্র ' + toBengaliNumber(remainingMinutes) + ' মিনিট সময় বাকি!', true);
    }
    
    if (state.timeLeft === 30 && !hasPlayedWarning) {
        document.body.className = 'warning-time';
        playWarningBeep();
        
        setTimeout(function() {
            if (state.timeLeft > 0 && state.timeLeft < 30) {
                document.body.className = '';
            }
        }, 30000);
    }
}

        function submitQuiz() {
			try {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
    } catch (e) {
        console.log('Exit fullscreen error');
    }
            if (state.timerInterval) clearInterval(state.timerInterval);
            document.body.className = '';
            document.body.style.background = '#0f766e';
            document.body.style.background = 'linear-gradient(135deg, #0f766e 0%, #065f46 50%, #064e3b 100%)';
            hasPlayedWarning = false;
            state.loading = true;
            render();
            
var timeTaken = Math.floor((Date.now() - state.startTime) / 1000);
var answeredCount = 0;
var unansweredCount = 0;

var submission = {
    sessionId: state.sessionId,
    name: state.participant.name,
    phone: state.participant.phone,
    timeTaken: formatTime(timeTaken),
    exitCount: state.exitCount,
    timestamp: Date.now(),
    answers: {}
};

for (var i = 0; i < QUESTIONS.length; i++) {
    var q = QUESTIONS[i];
    var userAnswer = state.answers[q.id];
    var answerText = '';
    
    if (userAnswer !== undefined && userAnswer !== '') {
        if (q.type === 'mcq') {
            answerText = getBengaliOption(userAnswer);  // শুধু অপশন
        } else if (q.type === 'short') {
            answerText = userAnswer;
        }
        answeredCount++;
    } else {
        answerText = 'X';
        unansweredCount++;
    }
    
    submission.answers['Q' + (i + 1)] = answerText;
}

submission.answeredCount = answeredCount;
submission.unansweredCount = unansweredCount;

            if (GOOGLE_SCRIPT_URL !== 'YOUR_GOOGLE_SCRIPT_URL_HERE') {
                var xhr = new XMLHttpRequest();
                xhr.open('POST', GOOGLE_SCRIPT_URL, true);
                xhr.send(JSON.stringify(submission));
            }

            state.submittedPhones[state.participant.phone] = Date.now();
            state.lastSubmission = submission;
            state.loading = false;
            state.view = 'submitted';
            state.sessionId = null;
            state.exitCount = 0;
            render();
        }

        function selectAnswer(qId, idx) {
    // Toggle: if already selected, unselect it
    if (state.answers[qId] === idx) {
        delete state.answers[qId];
    } else {
        state.answers[qId] = idx;
    }
    render();
}

        function selectShortAnswer(qId) {
            var input = document.getElementById('short-input-' + qId);
            if (input) {
                state.answers[qId] = input.value.trim();
            }
        }

function handleEnterKey(event, qId) {
    if (event.key === 'Enter' || event.keyCode === 13) {
        event.preventDefault();
        selectShortAnswer(qId);
        
        var isLast = state.currentQuestion === QUESTIONS.length - 1;
        if (!isLast) {
            nextQuestion();
        }
    }
}

        function nextQuestion() {
            if (state.currentQuestion < QUESTIONS.length - 1) {
                state.currentQuestion++;
                render();
            }
        }

        function prevQuestion() {
            if (state.currentQuestion > 0) {
                state.currentQuestion--;
                render();
            }
        }

        function renderStart() {
            document.body.className = '';
            var html = '<div class="container"><div class="card">' +
                '<h1>সীরাতুন নবী ﷺ প্রতিযোগিতা</h1>' +
                '<p class="subtitle">রাসূলুল্লাহ ﷺ এর জীবনী নিয়ে জ্ঞান প্রতিযোগিতা</p>' +
                '<div class="info-box"><h3>প্রতিযোগিতার বিবরণ:</h3><ul>' +
				'<li>মোট: <strong> ৫০ </strong> নম্বর  ||   সময়: <strong>' + toBengaliNumber(TotalTime / 60) + '</strong> মিনিট ( <strong>' + toBengaliNumber(TotalTime/60/60) + '</strong>  ঘণ্টা ) </li>' +
                '<li>মোট প্রশ্ন: <strong>' + toBengaliNumber(QUESTIONS.length) + '</strong> টি (৫০টি  + ২৫টি )</li>' +
				'<li>বহুনির্বাচনী (৫০ x ০.৫ = ২৫নম্বর) </li>' + 
				'<li>অতি সংক্ষিপ্ত (২৫ x ১ = ২৫নম্বর) </li>' +
                '<li>সব প্রশ্নের উত্তর দেওয়ার চেষ্টা করুন।</li>' +
                '</ul></div>' +
                '<div class="warning-box"><p>⚠️ প্রতিটি ভুল উত্তরের জন্য <b> ০.২৫ </b> নম্বর কর্তন করা হবে। বহুনির্বাচনী এবং অতি সংক্ষিপ্ত উভয়ের ক্ষেত্রে প্রযোজ্য।</p></div>' +
                '<div class="form-group"><label>👤 নাম <span style="color: #dc2626;">*</span> (বাংলা/English)</label>' +
                '<input type="text" id="name" placeholder="পূর্ণ নাম লিখুন"maxlength="32"></div>' +
                '<div class="form-group"><label>📱 মোবাইল নম্বর <span style="color: #dc2626;">*</span> (English)</label>' + 
                '<input type="tel" id="phone" placeholder="Ex: 01886667466"  maxlength="11"></div>' +
                '<button class="btn btn-primary" id="startBtn">বিসমিল্লাহির রাহমানির রাহীম</button>' +
                '</div></div>';
            return html;
        }

        function renderQuiz() {
            if (state.loading) {
                return '<div class="container"><div class="card">' +
                    '<div class="loading"><div class="loading-spinner"></div>' +
                    '<p style="margin-top:15px; font-size:16px; font-weight:600;">জমা হচ্ছে...</p>' +
                    '</div></div></div>';
            }
    
			var q = QUESTIONS[state.currentQuestion];

            if (state.timeLeft <= 30) {
                document.body.className = 'warning-time';
            } else {
                document.body.className = '';
            }
			
            var opts = '';

            if (q.type === 'mcq') {
                for (var i = 0; i < q.options.length; i++) {
                    var sel = state.answers[q.id] === i ? 'selected' : '';
                    opts += '<button class="option ' + sel + '" onclick="selectAnswer(' + q.id + ', ' + i + ')">' +
                        '<strong>' + getBengaliOption(i) + '.</strong> ' + q.options[i] +
                        '</button>';
                }
            } else if (q.type === 'short') {
                var currentAnswer = state.answers[q.id] || '';
                var filledClass = currentAnswer ? 'filled' : '';
                opts = '<input type="text" ' +
                    'id="short-input-' + q.id + '" ' +
                    'class="short-answer-input ' + filledClass + '" ' +
                    'placeholder="এখানে উত্তর লিখুন" ' +
                    'value="' + currentAnswer + '" ' +
                    'oninput="selectShortAnswer(' + q.id + ')" ' +
					'onkeypress="handleEnterKey(event, ' + q.id + ')" ' +
					'autofocus>';
            }

            var isLast = state.currentQuestion === QUESTIONS.length - 1;
           
            var html = '<div class="container">' +
                '<div class="timer-box">' +
                '<div class="timer-header">' +
                '<div class="timer-info">📝 প্রশ্ন ' + toBengaliNumber(state.currentQuestion + 1) + '/' + toBengaliNumber(QUESTIONS.length) + '</div>' +
                '<div class="' + (state.timeLeft <= 30 ? 'timer warning' : 'timer') + '">⏰ <span id="timer">' + formatTime(state.timeLeft) + '</span></div>' +
                '</div>' +
                '</div>' +
				'<div class="quiz-content-wrapper">' +  // এই wrapper add করুন
                '<div class="question-card">' +
                '<span class="question-badge">' + (q.type === 'mcq' ? 'বহুনির্বাচনী' : 'অতি সংক্ষিপ্ত') + '</span>' +
                '<div class="question-text">' + q.question + '</div>' +
                opts +
                '</div>' +
                '<div class="nav-buttons">' +
                '<button class="btn btn-secondary" onclick="prevQuestion()" ' + (state.currentQuestion === 0 ? 'disabled' : '') + '><span style="font-size: 20px;">←</span> পূর্ববর্তী</button>';

            if (isLast) {
                html += '<button class="btn btn-danger" onclick="submitQuiz()">✓ জমা দিন</button>';
            } else {
                html += '<span style="flex: 1;"></span>';
            }

            html += '<button class="btn btn-secondary" onclick="nextQuestion()" ' + (isLast ? 'disabled' : '') + '>পরবর্তী <span style="font-size: 20px;">→</span></button>';
            html += '</div>' +  // nav-buttons close
        '</div>' +  // quiz-content-wrapper close
        '</div>';  // container close
            return html;
        }

       function renderSubmitted() {
    var answersList = '';
    
    for (var i = 0; i < QUESTIONS.length; i++) {
        var q = QUESTIONS[i];
        var userAnswer = state.answers[q.id];
        var answerText = '';
        
        if (userAnswer !== undefined && userAnswer !== '') {
            if (q.type === 'mcq') {
                answerText = '<span style="color: #059669;">' + getBengaliOption(userAnswer) + '. ' + q.options[userAnswer] + '</span>';
            } else if (q.type === 'short') {
                answerText = '<span style="color: #059669;">' + userAnswer + '</span>';
            }
        } else {
            answerText = '<span style="color: #dc2626; font-weight: 700;">✗ উত্তর দেননি</span>';
        }
        
        answersList += '<li style="padding: 8px; background: ' + (i % 2 === 0 ? '#f9fafb' : 'white') + '; border-radius: 6px; margin-bottom: 4px;">' +
            '<strong style="color: #065f46;">প্রশ্ন ' + toBengaliNumber(i + 1) + ':</strong> ' + answerText + '</li>';
    }
    
    var sessionId = state.lastSubmission.sessionId;
    
    return '<div class="container"><div class="card">' +
        '<div class="success-icon">✅</div>' +
        '<div class="success-message">' +
        '<h2 style="color: #065f46; font-size: 26px; margin-bottom: 12px;">জমা সফল হয়েছে!</h2>' +
        '<p style="font-size: 16px; color: #374151; margin: 12px 0; font-weight: 600;">' + state.participant.name + '</p>' +
        '<p style="font-size: 14px; color: #6b7280; margin-bottom: 20px;">আপনার উত্তরপত্র সফলভাবে জমা হয়েছে।</p>' +
        
        '<div class="info-box" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-color: #3b82f6; margin-bottom: 15px;">' +
        '<h3 style="color: #1e40af; margin-bottom: 8px; font-size: 15px;">🆔 Session ID</h3>' +
        '<p style="color: #1e3a8a; font-size: 16px; font-weight: 900; font-family: monospace; margin: 0; letter-spacing: 0.5px; word-break: break-all;">' + 
        sessionId + '</p>' +
        '<p style="color: #3b82f6; font-size: 11px; margin-top: 6px; font-weight: 600;">এই ID টি সংরক্ষণ করুন</p>' +
        '</div>' +
        
        '<div class="info-box" style="margin-bottom: 15px;">' +
        '<h3>📊 পরীক্ষার তথ্য</h3><ul style="margin: 0;">' +
        '<li>সময় লেগেছে: <strong>' + state.lastSubmission.timeTaken + '</strong></li>' +
        '<li>উত্তর দিয়েছেন: <strong>' + toBengaliNumber(state.lastSubmission.answeredCount) + ' টি</strong></li>' +
        '<li>উত্তর দেননি: <strong>' + toBengaliNumber(state.lastSubmission.unansweredCount) + ' টি</strong></li>' +
        '</ul></div>' +
        
        '<button onclick="downloadPDF()" class="btn btn-primary" style="margin-bottom: 12px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); display: flex; align-items: center; justify-content: center; gap: 8px;">' +
        '<span style="font-size: 18px;">📥</span> PDF ডাউনলোড করুন</button>' +
        
        '<div class="info-box" style="margin-top: 15px; max-height: 350px; overflow-y: auto;">' +
        '<h3 style="position: sticky; top: 0; background: #d1fae5; padding: 10px 0; margin: -16px -16px 12px -16px; padding-left: 16px; z-index: 1;">📝 আপনার দেওয়া উত্তরসমূহ</h3>' +
        '<ul style="margin: 0; padding: 0; list-style: none;">' +
        answersList +
        '</ul></div>' +
        
        '<div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 12px; padding: 12px; margin-top: 15px;">' +
        '<p style="color: #78350f; font-size: 13px; margin: 0; font-weight: 600; text-align: center;">📢 ফলাফল ২-৩ দিনের মধ্যে প্রকাশ করা হবে ইনশাআল্লাহ্‌</p>' +
        '</div>' +
        
        '<p style="color:#6b7280; margin-top: 20px; font-size: 14px; text-align: center;">জাযাকাল্লাহু খাইরান 🤲</p>' +
        '</div></div></div>';
}

        function render() {
            var app = document.getElementById('app');
            if (state.view === 'start') {
                app.innerHTML = renderStart();
            } else if (state.view === 'quiz') {
                app.innerHTML = renderQuiz();
				
				// Auto focus for short answer questions
        setTimeout(function() {
            var q = QUESTIONS[state.currentQuestion];
            if (q.type === 'short') {
                var input = document.getElementById('short-input-' + q.id);
                if (input) {
                    input.focus();
                    input.click(); // Extra trigger for mobile
                }
            }
        }, 150);
				
            } else if (state.view === 'submitted') {
                app.innerHTML = renderSubmitted();
            }
        }

        function showExitWarning() {
            var modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'exitModal';
            modal.innerHTML = '<div class="modal-inner"><div class="modal-content">' +
                '<div style="font-size: 50px; margin-bottom: 15px;">⚠️</div>' +
                '<h3 style="color: #dc2626; margin-bottom: 12px; font-size: 20px; font-weight: 800;">সতর্কতা!</h3>' +
                '<p style="color: #374151; margin-bottom: 12px; font-size: 15px; font-weight: 600;">' +
                'আপনি পরীক্ষা থেকে বের হয়ে গিয়েছিলেন।</p>' +
                '<div style="background: #fee2e2; padding: 12px; border-radius: 10px; margin-bottom: 15px; border: 2px solid #fca5a5;">' +
                '<p style="color: #dc2626; font-weight: 800; font-size: 18px; margin: 0;">বের হওয়া: ' + state.exitCount + '/2</p>' +
                '</div>' +
                '<p style="color: ' + (state.exitCount === 2 ? '#dc2626' : '#6b7280') + '; font-size: 13px; margin-bottom: 20px; font-weight: ' + (state.exitCount === 2 ? '700' : '500') + ';">' +
                (state.exitCount === 2 ? '🚨 আরেকবার বের হলে বাতিল!' : '⚠️ সতর্ক থাকুন।') + '</p>' +
                '<button onclick="closeExitWarning()" style="background: #10b981; color: white; border: none; padding: 12px 30px; border-radius: 10px; font-size: 15px; font-weight: 700; cursor: pointer;">' +
                'চালিয়ে যান</button></div></div>';
            document.body.appendChild(modal);
        }

        function closeExitWarning() {
            var modal = document.getElementById('exitModal');
            if (modal) {
                modal.parentNode.removeChild(modal);
            }
            startTimer();
            render();
        }

        function resetQuiz() {
            if (state.timerInterval) clearInterval(state.timerInterval);
            document.body.className = '';
            hasPlayedWarning = false;
            var submittedPhones = state.submittedPhones;
            state = {
                view: 'start',
                participant: { name: '', phone: '' },
                answers: {},
                currentQuestion: 0,
                timeLeft: TotalTime,
                startTime: null,
                timerInterval: null,
                loading: false,
                lastSubmission: null,
                submittedPhones: submittedPhones,
                exitCount: 0,
                sessionId: null,
                warningPlayed: false,
				halfTimeShown: false,      // Reset this
                fifteenMinShown: false     // Reset this
            };
            render();
        }
		
		function downloadPDF() {
    var pdfContent = document.createElement('div');
    pdfContent.style.cssText = 'position: absolute; left: -9999px; top: 0; width: 800px; background: white; padding: 40px; font-family: Arial, sans-serif;';
    
    var sessionId = state.lastSubmission.sessionId;
    
    var html = '<div style="text-align: center; margin-bottom: 30px;">' +
        '<h1 style="color: #065f46; font-size: 32px; margin: 0 0 10px 0;">সীরাতুন নবী ﷺ প্রতিযোগিতা</h1>' +
        '<p style="color: #6b7280; font-size: 16px; margin: 0;">উত্তরপত্র</p>' +
        '</div>' +
        
        '<div style="background: #dbeafe; border: 3px solid #3b82f6; border-radius: 12px; padding: 20px; margin-bottom: 25px;">' +
        '<h3 style="color: #1e40af; font-size: 18px; margin: 0 0 10px 0;">🆔 Session ID</h3>' +
        '<p style="color: #1e3a8a; font-size: 20px; font-weight: bold; font-family: monospace; margin: 0; word-break: break-all;">' + 
        sessionId + '</p>' +
        '</div>' +
        
        '<div style="background: #f3f4f6; border-radius: 10px; padding: 20px; margin-bottom: 25px;">' +
        '<h3 style="color: #065f46; font-size: 18px; margin: 0 0 15px 0;">👤 অংশগ্রহণকারীর তথ্য</h3>' +
        '<p style="margin: 8px 0; color: #374151; font-size: 15px;"><strong>নাম:</strong> ' + state.participant.name + '</p>' +
        '<p style="margin: 8px 0; color: #374151; font-size: 15px;"><strong>মোবাইল:</strong> ' + state.participant.phone + '</p>' +
        '<p style="margin: 8px 0; color: #374151; font-size: 15px;"><strong>সময় লেগেছে:</strong> ' + state.lastSubmission.timeTaken + '</p>' +
        '<p style="margin: 8px 0; color: #374151; font-size: 15px;"><strong>উত্তর দিয়েছেন:</strong> ' + toBengaliNumber(state.lastSubmission.answeredCount) + ' টি</p>' +
        '<p style="margin: 8px 0; color: #374151; font-size: 15px;"><strong>উত্তর দেননি:</strong> ' + toBengaliNumber(state.lastSubmission.unansweredCount) + ' টি</p>' +
        '</div>' +
        
        '<div style="margin-bottom: 20px;">' +
        '<h3 style="color: #065f46; font-size: 20px; margin: 0 0 15px 0; border-bottom: 3px solid #10b981; padding-bottom: 10px;">📝 আপনার দেওয়া উত্তরসমূহ</h3>';
    
    for (var i = 0; i < QUESTIONS.length; i++) {
        var q = QUESTIONS[i];
        var userAnswer = state.answers[q.id];
        var answerText = '';
        var answerColor = '#059669';
        
        if (userAnswer !== undefined && userAnswer !== '') {
            if (q.type === 'mcq') {
                answerText = getBengaliOption(userAnswer) + '. ' + q.options[userAnswer];
            } else if (q.type === 'short') {
                answerText = userAnswer;
            }
        } else {
            answerText = '✗ উত্তর দেননি';
            answerColor = '#dc2626';
        }
        
        html += '<div style="background: ' + (i % 2 === 0 ? '#f9fafb' : 'white') + '; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #10b981;">' +
            '<p style="margin: 0 0 8px 0; color: #065f46; font-size: 15px; font-weight: bold;">প্রশ্ন ' + toBengaliNumber(i + 1) + ': ' + q.question + '</p>' +
            '<p style="margin: 0; color: ' + answerColor + '; font-size: 14px; font-weight: 600;">উত্তর: ' + answerText + '</p>' +
            '</div>';
    }
    
    html += '</div>' +
        '<div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e7eb;">' +
        '<p style="color: #6b7280; font-size: 14px; margin: 0;">জাযাকাল্লাহু খাইরান 🤲</p>' +
        '<p style="color: #9ca3af; font-size: 12px; margin: 5px 0 0 0;">Generated on ' + new Date().toLocaleString('bn-BD') + '</p>' +
        '</div>';
    
    pdfContent.innerHTML = html;
    document.body.appendChild(pdfContent);
    
    // Show loading
    var loadingDiv = document.createElement('div');
    loadingDiv.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 99999; display: flex; align-items: center; justify-content: center;';
    loadingDiv.innerHTML = '<div style="background: white; padding: 30px 50px; border-radius: 12px; text-align: center;">' +
        '<div style="border: 4px solid #f3f4f6; border-top: 4px solid #10b981; border-radius: 50%; width: 50px; height: 50px; margin: 0 auto 20px auto; animation: spin 1s linear infinite;"></div>' +
        '<p style="color: #374151; font-size: 16px; font-weight: 600; margin: 0;">PDF তৈরি হচ্ছে...</p>' +
        '</div>';
    document.body.appendChild(loadingDiv);
    
    setTimeout(function() {
        html2canvas(pdfContent, {
            scale: 2,
            useCORS: true,
            logging: false,
            backgroundColor: '#ffffff'
        }).then(function(canvas) {
            var { jsPDF } = window.jspdf;
            
            var imgWidth = 210;
            var pageHeight = 297;
            var imgHeight = canvas.height * imgWidth / canvas.width;
            var heightLeft = imgHeight;
            var position = 0;
            
            var pdf = new jsPDF('p', 'mm', 'a4');
            var imgData = canvas.toDataURL('image/png');
            
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
            
            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }
            
            pdf.save('Seerah_Quiz_' + sessionId.substr(0, 10) + '.pdf');
            
            document.body.removeChild(pdfContent);
            document.body.removeChild(loadingDiv);
        }).catch(function(error) {
            console.error('PDF Error:', error);
            alert('PDF তৈরিতে সমস্যা হয়েছে। আবার চেষ্টা করুন।');
            document.body.removeChild(pdfContent);
            document.body.removeChild(loadingDiv);
        });
    }, 500);
}

        var hiddenTime = null;

        window.onbeforeunload = function(e) {
            if (state.view === 'quiz' && state.sessionId) {
                e = e || window.event;
                if (e) {
                    e.returnValue = '';
                }
                return '';
            }
        };

        if (document.addEventListener) {
            document.addEventListener('visibilitychange', function() {
                if (state.view !== 'quiz' || !state.sessionId) return;

                if (document.hidden) {
                    hiddenTime = Date.now();
                } else {
                    if (hiddenTime) {
                        var awayTime = Math.floor((Date.now() - hiddenTime) / 1000);
                        
                        if (awayTime >= 3) {
                            state.exitCount++;
                            
                            if (state.exitCount > 2) {
                                if (state.timerInterval) clearInterval(state.timerInterval);
                                alert('⚠️ আপনি ২ বারের বেশি পরীক্ষা থেকে বের হয়ে গেছেন!');
                                submitQuiz();
                                return;
                            }
                            
                            showExitWarning();
                            return;
                        }
                        
                        hiddenTime = null;
                    }
                    
                    if (state.timerInterval) {
                        clearInterval(state.timerInterval);
                    }
                    startTimer();
                    render();
                }
            });
        }

        window.onload = function() {
            render();
	   // Add event listener for start button
    document.addEventListener('click', function(e) {
        if (e.target && e.target.id === 'startBtn') {
            startQuiz();
        }
    });
        };

    </script>
</body>
</html>












